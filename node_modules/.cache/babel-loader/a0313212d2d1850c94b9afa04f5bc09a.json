{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _slicedToArray from\"/Users/sagardalal/Desktop/Desktop/ReactJS/social-app-github/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useContext,useEffect,useState}from\"react\";import{SignInBtn}from\"../../components\";import{UserContext}from\"../../contexts/user\";import\"./style.css\";import AddAPhotoIcon from\"@material-ui/icons/AddAPhoto\";import makeId from\"../../helper/functions\";import{db,storage}from\"../../firebase\";import firebase from\"firebase\";import{DarkModeContext}from\"../../contexts/darkmode\";export default function CreatePost(){var _useContext$user=_slicedToArray(useContext(UserContext).user,2),user=_useContext$user[0],setUser=_useContext$user[1];var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),caption=_useState2[0],setCaption=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),image=_useState4[0],setImage=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),progress=_useState6[0],setProgress=_useState6[1];var _useContext$DarkMode=_slicedToArray(useContext(DarkModeContext).DarkMode,2),DarkMode=_useContext$DarkMode[0],setDarkMode=_useContext$DarkMode[1];var createPost__loggedInCss=\"createPost__loggedIn\";var createPost__textarea=\"createPost__textarea\";if(DarkMode){createPost__textarea=\"createPost__textarea dark\";createPost__loggedInCss=\"createPost__loggedIn dark\";}firebase.auth().onAuthStateChanged(function(user){setUser(user);});var handleChange=function handleChange(e){if(e.target.files[0]){setImage(e.target.files[0]);var selectedImageSrc=URL.createObjectURL(e.target.files[0]);var imagePreview=document.getElementById(\"image-preview\");imagePreview.src=selectedImageSrc;imagePreview.style.display=\"block\";}};var handleUpload=function handleUpload(){if(image){var imageName=makeId(10);var uploadTask=storage.ref(\"images/\".concat(imageName,\".jpg\")).put(image);uploadTask.on(\"state_changed\",function(snapshot){//progress function\nvar progress=Math.round(snapshot.bytesTransferred/snapshot.totalBytes*100);setProgress(progress);},function(error){console.log(error);},function(){//get download url and upload the post info\nstorage.ref(\"images\").child(\"\".concat(imageName,\".jpg\")).getDownloadURL().then(function(imageUrl){db.collection(\"posts\").add({timestamp:firebase.firestore.Timestamp.now(),caption:caption,photoUrl:imageUrl,username:user.email.replace(\"@gmail.com\",\"\"),profileUrl:user.photoURL});});setCaption(\"\");setProgress(0);setImage(null);document.getElementById(\"image-preview\").style.display=\"none\";console.log(\"image nulled\");});}};return/*#__PURE__*/_jsx(\"div\",{className:\"createPost\",children:user?/*#__PURE__*/_jsxs(\"div\",{className:createPost__loggedInCss,children:[/*#__PURE__*/_jsx(\"p\",{children:\"Create Post\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"createPost__loggedInCenter\",children:[/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"enter caption here..\",className:createPost__textarea,rows:\"3\",value:caption,onChange:function onChange(e){return setCaption(e.target.value);}}),/*#__PURE__*/_jsx(\"div\",{className:\"createPost__imagePreview\",children:/*#__PURE__*/_jsx(\"img\",{id:\"image-preview\",alt:\"\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"creatPost__loggedInBottom\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"createPost__imageUpload\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"fileInput\",children:/*#__PURE__*/_jsx(AddAPhotoIcon,{style:{cursor:\"pointer\",fontSize:\"20px\"}})}),/*#__PURE__*/_jsx(\"input\",{id:\"fileInput\",type:\"file\",accept:\"image/*\",onChange:handleChange})]}),/*#__PURE__*/_jsx(\"button\",{className:\"createPost__uploadBtn\",onClick:handleUpload,style:{color:DarkMode?caption?\"#FFFFFF\":\"lightgrey\":caption?\"#000\":\"lightgrey\"},children:\"Upload \".concat(progress!=0?progress:\"\")})]})]}):/*#__PURE__*/_jsx(\"div\",{})});}","map":{"version":3,"sources":["/Users/sagardalal/Desktop/Desktop/ReactJS/social-app-github/src/containers/create-post/index.js"],"names":["React","useContext","useEffect","useState","SignInBtn","UserContext","AddAPhotoIcon","makeId","db","storage","firebase","DarkModeContext","CreatePost","user","setUser","caption","setCaption","image","setImage","progress","setProgress","DarkMode","setDarkMode","createPost__loggedInCss","createPost__textarea","auth","onAuthStateChanged","handleChange","e","target","files","selectedImageSrc","URL","createObjectURL","imagePreview","document","getElementById","src","style","display","handleUpload","imageName","uploadTask","ref","put","on","snapshot","Math","round","bytesTransferred","totalBytes","error","console","log","child","getDownloadURL","then","imageUrl","collection","add","timestamp","firestore","Timestamp","now","photoUrl","username","email","replace","profileUrl","photoURL","value","cursor","fontSize","color"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from \"react\";\nimport { SignInBtn } from \"../../components\";\nimport { UserContext } from \"../../contexts/user\";\nimport \"./style.css\";\n\nimport AddAPhotoIcon from \"@material-ui/icons/AddAPhoto\";\nimport makeId from \"../../helper/functions\";\nimport { db, storage } from \"../../firebase\";\n\nimport firebase from \"firebase\";\nimport { DarkModeContext } from \"../../contexts/darkmode\";\n\nexport default function CreatePost() {\n  const [user, setUser] = useContext(UserContext).user;\n  const [caption, setCaption] = useState(\"\");\n  const [image, setImage] = useState(null);\n  const [progress, setProgress] = useState(0);\n  const [DarkMode, setDarkMode] = useContext(DarkModeContext).DarkMode;\n  var createPost__loggedInCss = \"createPost__loggedIn\";\n  var createPost__textarea = \"createPost__textarea\";\n  if (DarkMode) {\n    createPost__textarea = \"createPost__textarea dark\";\n    createPost__loggedInCss = \"createPost__loggedIn dark\";\n  }\n\n  firebase.auth().onAuthStateChanged(function (user) {\n    setUser(user);\n  });\n\n  const handleChange = (e) => {\n    if (e.target.files[0]) {\n      setImage(e.target.files[0]);\n\n      var selectedImageSrc = URL.createObjectURL(e.target.files[0]);\n\n      var imagePreview = document.getElementById(\"image-preview\");\n\n      imagePreview.src = selectedImageSrc;\n      imagePreview.style.display = \"block\";\n    }\n  };\n\n  const handleUpload = () => {\n    if (image) {\n      var imageName = makeId(10);\n      const uploadTask = storage.ref(`images/${imageName}.jpg`).put(image);\n      uploadTask.on(\n        \"state_changed\",\n        (snapshot) => {\n          //progress function\n\n          const progress = Math.round(\n            (snapshot.bytesTransferred / snapshot.totalBytes) * 100\n          );\n          setProgress(progress);\n        },\n        (error) => {\n          console.log(error);\n        },\n        () => {\n          //get download url and upload the post info\n          storage\n            .ref(\"images\")\n            .child(`${imageName}.jpg`)\n            .getDownloadURL()\n            .then((imageUrl) => {\n              db.collection(\"posts\").add({\n                timestamp: firebase.firestore.Timestamp.now(),\n                caption: caption,\n                photoUrl: imageUrl,\n                username: user.email.replace(\"@gmail.com\", \"\"),\n                profileUrl: user.photoURL,\n              });\n            });\n          setCaption(\"\");\n          setProgress(0);\n          setImage(null);\n          document.getElementById(\"image-preview\").style.display = \"none\";\n          console.log(\"image nulled\");\n        }\n      );\n    }\n  };\n\n  return (\n    <div className=\"createPost\">\n      {user ? (\n        <div className={createPost__loggedInCss}>\n          <p>Create Post</p>\n          <div className=\"createPost__loggedInCenter\">\n            <textarea\n              placeholder=\"enter caption here..\"\n              className={createPost__textarea}\n              rows=\"3\"\n              value={caption}\n              onChange={(e) => setCaption(e.target.value)}\n            ></textarea>\n            <div className=\"createPost__imagePreview\">\n              <img id=\"image-preview\" alt=\"\" />\n            </div>\n          </div>\n          <div className=\"creatPost__loggedInBottom\">\n            <div className=\"createPost__imageUpload\">\n              <label htmlFor=\"fileInput\">\n                <AddAPhotoIcon\n                  style={{ cursor: \"pointer\", fontSize: \"20px\" }}\n                />\n              </label>\n\n              <input\n                id=\"fileInput\"\n                type=\"file\"\n                accept=\"image/*\"\n                onChange={handleChange}\n              ></input>\n            </div>\n            <button\n              className=\"createPost__uploadBtn\"\n              onClick={handleUpload}\n              style={{\n                color: DarkMode\n                  ? caption\n                    ? \"#FFFFFF\"\n                    : \"lightgrey\"\n                  : caption\n                  ? \"#000\"\n                  : \"lightgrey\",\n              }}\n            >\n              {`Upload ${progress != 0 ? progress : \"\"}`}\n            </button>\n          </div>\n        </div>\n      ) : (\n        <div></div>\n      )}\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}